<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>RCV</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <link rel="shortcut icon" type="image/png" href="img/logo_acv2.png"/>
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.3/dist/leaflet.css" />
	<link rel="stylesheet" href="style.css" />
  

    <link rel="stylesheet" href="src/leaflet-sidebar.css" />

</head>

<body>
    <div id="sidebar" class="sidebar collapsed">
        <!-- Nav tabs -->
        <div class="sidebar-tabs">
            <ul role="tablist">
                <li><a href="#home" role="tab" id="logo_acv"><i class="fa"><img src="img/logo_acv2.png" style="width:30px;padding:5px"  /></i></a></li>
                <li><a href="http://www.cget.gouv.fr/dossiers/action-coeur-de-ville" role="tab" target="_blank" title="Site officiel"><i class="fa fa-home"></i></a></li>
				<li><a href="https://rawgit.com/cget-carto/c2v/master/img/ACV_CARTO_sept18.jpg" role="tab" target="_blank" title="Télécharger la carte"><i class="fa fa-download"></i></a></li>
            </ul>
        </div>

        <!-- Tab panes -->
        <div class="sidebar-content">
            <div class="sidebar-pane" id="home">
                <h1 style="text-transform:uppercase" class="sidebar-header">
                    Réinventons nos cœurs de ville
                    <span class="sidebar-close" id="close"><i class="fa fa-caret-left"></i></span>
                </h1>
				
				<div class="presentation" id="defaut">
					<div><img src="img/logo_acv_420.png" style="max-width:60%; padding:25px;" /></div>
					<h1>222 territoires bénéficiaires</h1>
					<p class="lorem"><img src="img/pictos_checked_off.png" style="vertical-align:center;width:20px;padding:0px 10px;"  />Ville retenue : contrat signé</p>
					<p class="lorem"><img src="img/pictos_unchecked_off.png" style="vertical-align:center;width:20px;padding:0px 10px;"  />Ville retenue : contrat non signé</p>
					<h2>Agir sur les centres-villes au service des territoires </h2>
					<p class="lorem">Le plan « Action Cœur de Ville » est <strong>un grand plan d’investissement public sur cinq ans</strong> (2018-2022) à destination des 222 villes intermédiaires qui structurent le territoire national. Il cible plus spécifiquement leurs centres-villes, qui rayonnent sur de larges bassins de vie.</p>
					<p class="lorem">A des degrés divers, ces territoires sont confrontés à la dévitalisation de leurs centres, à la mesure du déclin démographique, de la dégradation de l’offre d’habitat et de la fuite des activités commerciales en périphérie notamment. « Action Cœur de Ville » apporte <strong>une réponse globale et transversale</strong>, à partir d’un projet porté par la collectivité, qui doit se construire autour de <strong>cinq axes :</p>
					<p class="lorem">1. De la réhabilitation à la restructuration : vers une offre attractive de l’habitat en centre-ville</p>
					<p class="lorem">2. Favoriser un développement économique et commercial équilibré</p>
					<p class="lorem">3. Développer l’accessibilité, la mobilité et les connexions</p>
					<p class="lorem">4. Mettre en valeur les formes urbaines, l’espace public et le patrimoine</p>
					<p class="lorem">5. Fournir l’accès aux équipements, services publics, à l’offre culturelle et de loisirs</p></strong>
					<h2>Un plan «sur-mesure» décentralisé et déconcentré</h2>
					<p class="lorem"><strong>« Action Cœur de Ville » va jusqu’au bout de la logique de décentralisation et de déconcentration</strong>. Le soutien de l’État et des partenaires nationaux se formalise par la conclusion d’une convention-cadre pluriannuelle avec la commune et son intercommunalité.<br/><strong>Le cadre partenarial</strong> permet d’inclure à cette convention tout acteur public ou privé pouvant mettre ses moyens ou son expertise au service du cœur de ville : établissement public foncier, agence d’urbanisme, bailleur social, associations, entreprises…</p>
					<p class="lorem"><strong>Les projets sont conçus par les collectivités</strong>, qui sollicitent les financements auprès des services déconcentrés de l’Etat et des partenaires, réunis dans un comité de projet présidé par le maire.</p>
					<p class="lorem"><strong>Cette méthode «sur-mesure» permet d’accompagner les collectivités à leur rythme</strong>, de mettre en œuvre les actions déjà matures lors de la conclusion de la convention et de réaliser en même temps toutes les études nécessaires au projet de revitalisation du centre-ville.</p>
				
				<br/>
					<p><i>Sources : <a href="http://www.cget.gouv.fr/" style="text-decoration:none;" target="_blanck ">CGET</a> • Réalisation : <a href="http://www.cget.gouv.fr/ressources/cartotheque" style="text-decoration:none;" target="_blanck ">CGET service cartographie</a> • Dernière mise à jour : 01 octobre 2018</i></p>
				
				</div>

				<div id="popup">
					<h1 id="libgeo"></h1>
					<p class="lorem" id="region"></p>
					<p class="lorem" id="signature"></p>
					<p class="lorem" id="action"></p>					
					<p class="lorem" id="projet"></p>
				</div>
				
            </div>

            <div class="sidebar-pane" id="profile">
                <h1 class="sidebar-header">Profile<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
            </div>

        </div>
    </div>


	<div id="mapid"></div>
	
     <script src="https://unpkg.com/leaflet@1.3.3/dist/leaflet.js"></script>
    <script src="https://turbo87.github.io/sidebar-v2/js/leaflet-sidebar.js"></script>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.5.1/tabletop.min.js'></script>
	<script type="text/javascript" src="data/masque.js"></script>
	<script type="text/javascript" src="data/cercles_drom.js"></script>
	<script type="text/javascript" src="data/toutesCouches.js"></script>
	
    <script>
		
			
		// Création de la carte
		var map = L.map('mapid', {maxZoom:8, minZoom:6, maxBounds: [[39, -28],[54, 30]]})
		.setView([46.5, -1.8], 6);
		map.zoomControl.setPosition('topright');
		map.attributionControl.addAttribution('<a href="https://cartotheque.cget.gouv.fr/cartes" style="text-decoration:none;" target="_blank ">CGET</a>');
		
		//Ajout de la sidebar
		var sidebar = L.control.sidebar('sidebar').addTo(map);

		
/* COULEURS - STYLES - LEGENDE */
		
		//Définition des pictos
		var LeafIcon = L.Icon.extend({
		options: {
		}
		});
		var uncheckedIcon_off = new LeafIcon({iconUrl: 'img/pictos_unchecked_off.png', iconSize: [17,17], iconAnchor:[8.5,8.5]}),
			checkedIcon_off = new LeafIcon({iconUrl: 'img/pictos_checked_off.png', iconSize: [19,19], iconAnchor:[9.5,9.5]}),
			uncheckedIcon_on = new LeafIcon({iconUrl: 'img/pictos_unchecked_on.png', iconSize: [33,33], iconAnchor:[16.5,16.5]}),
			checkedIcon_on = new LeafIcon({iconUrl: 'img/pictos_checked_on.png', iconSize: [33,33], iconAnchor:[16.5,16.5]});

/* DONNEES DRIVE */
			
		//Ajout des données drive
		var publicSpreadsheetUrl = 'https://docs.google.com/spreadsheets/d/17Fj-vJg50BOjz5WLqhSy-BPdouadxqnCTM81OUiRJ6E/edit?usp=sharin';
		
		function init() {
			Tabletop.init({ 
				key: publicSpreadsheetUrl,
				callback: showInfo,
				simpleSheet: true
			})
		}
	
		//Création du layer de markers
		var markersLayer = new L.layerGroup();
		markersLayer.addTo(map);
	
		//Aller chercher les données et créer les markers
		function showInfo(data, tabletop) {
		
			for (var i in data){
				
				marker = new L.marker([data[i].LAT, data[i].LNG], {title: data[i].lib_com});
				
				if (data[i].ID_ASSO == 'AMF'){marker.setIcon(uncheckedIcon_off); marker.on('mouseover', function(e) {e.target.setIcon(uncheckedIcon_on); }); marker.on('mouseout', function(e) {e.target.setIcon(uncheckedIcon_off); });}
				else if (data[i].ID_ASSO == 'ATMF'){marker.setIcon(checkedIcon_off); marker.on('mouseover', function(e) {e.target.setIcon(checkedIcon_on); }); marker.on('mouseout', function(e) {e.target.setIcon(checkedIcon_off); });}
				else {marker.setIcon(checkedIcon_off); marker.on('mouseover', function(e) {e.target.setIcon(checkedIcon_on); }); marker.on('mouseout', function(e) {e.target.setIcon(checkedIcon_off); });}
				
				marker.properties = {};
				marker.properties.ID_ASSO = data[i].ID_ASSO;

				marker.bindTooltip(data[i].ID_ASSO, {className: 'Tooltips', closeButton: false, offset: [0,-30]});
				//marker.on('click', function(e) {popup(e.target); markerCible(e.target) });
				
				marker.addTo(markersLayer);
				
			}
		}

		window.addEventListener('DOMContentLoaded', init)
	
/* CREATION DES COUCHES */		
		
		//Niveaux d'affichage des couches
		map.createPane('fond');
		map.getPane('fond').style.zIndex = 500;
		map.createPane('contour');
		map.getPane('contour').style.zIndex = 500;
		map.createPane('cercles');
		map.getPane('cercles').style.zIndex = 510;
		map.createPane('metro');
		map.getPane('metro').style.zIndex = 520;
		map.createPane('metCible2');
		map.getPane('metCible2').style.zIndex = 525;
		map.createPane('metCible');
		map.getPane('metCible').style.zIndex = 530;
		
		//Couches du fond de carte
		Cache = L.geoJSON(JS_masque, {color: "#fdece3", weight: 0, opacity: 1, fillOpacity: 1}).addTo(map);
		Cercles_drom = L.geoJSON(JS_drom, {color: "#ffffff", weight: 2, opacity: 0.7, fillOpacity: 0}).addTo(map);
		
		Fond_Regions = L.geoJSON(JS_tout, {
			filter: function(feature, layer) {return feature.properties.type=="région"},
			style : {weight: 0, opacity: 1, fillOpacity: 1, fillColor:"#ffc20e", pane: "fond"}
			}).addTo(map);
		
		Contour_Regions = L.geoJSON(JS_tout, {
			filter: function(feature, layer) {return feature.properties.type=="région"},
			style : {color: "#ffffff", weight: 2, opacity: 1, fillOpacity: 0, pane: "contour"}
			}).addTo(map);
		
		Departements = L.geoJSON(JS_tout, {
			filter: function(feature, layer) {return feature.properties.type=="départemen"},
			style: {color: "#ffffff", weight: 1, opacity: 1, fillOpacity: 0, pane: "contour"}
			}).addTo(map);
		
		ZAU = L.geoJSON(JS_tout, {
			filter: function(feature, layer) {return feature.properties.type=="zau"},
			style: function(feature){
				if (feature.properties.codgeo=="120"){
					return {opacity: 1, fillOpacity: 1, weight: 0, color:"#ffb80e", pane: "fond"};
				}
				else if (feature.properties.codgeo=="112"){
					return {opacity: 1, fillOpacity: 1, weight: 0, color:"#ffae0e", pane: "fond"};
				}
				else if (feature.properties.codgeo=="111"){
					return {opacity: 1, fillOpacity: 1, weight: 0, color:"#ffa40e", pane: "fond"};
				}
				else {
					return {opacity: 1, fillOpacity: 1, weight: 0, color:"#ffc20e", pane: "fond"};
				}
			}
		})
		.addTo(map);
				
		
		//Events au clic sur la carte
		map.on('click', function(e) {   
			if (document.getElementById('sidebar').classList.contains('collapsed')) {
				sidebar.open('home');
			}
			else {
				sidebar.close();
				map.setView([46.5, 2], 6);
			}
			document.getElementById('popup').style.display = "none";
			document.getElementById('defaut').style.display = "block";   
		});
		

   </script>
	
</body>



</html>
